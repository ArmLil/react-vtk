{"ast":null,"code":"var _jsxFileName = \"/home/lilit/workspace/vtk/from_scratch_frontend_vtk/src/containers/Locations.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport { useSnackbar } from \"notistack\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport Button from \"@material-ui/core/Button\";\nimport LocationTable from \"../components/Location/LocationTable\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar moment = require(\"moment\");\n\nconst Location = () => {\n  _s();\n\n  const [locations, setLocations] = useState({});\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  useEffect(() => {\n    const getLocations = async () => {\n      const locationsFromServer = await fetchLocations();\n      setLocations(locationsFromServer);\n    };\n\n    getLocations();\n  }, []); // Fetch Locations\n\n  const fetchLocations = async () => {\n    const res = await fetch(\"http://localhost:3001/api/v1/locations\");\n    const data = await res.json();\n    let columns = [];\n    let rows = data.locations.rows;\n    let locColumns = [];\n    if (data.locations.count > 0) locColumns = Object.keys(data.locations.rows[0]);\n    locColumns.forEach(item => {\n      let obj = {};\n\n      switch (item) {\n        case \"id\":\n          obj.headerName = \"ID\";\n          obj.field = item;\n          obj.hide = true;\n          break;\n\n        case \"number\":\n          obj.headerName = \"Номер\";\n          obj.field = item;\n          obj.flex = 0.1;\n          break;\n\n        case \"name\":\n          obj.headerName = \"Название\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n\n        case \"createdAt\":\n          obj.headerName = \"Дата создания\";\n          obj.field = item;\n          obj.flex = 0.2;\n          break;\n\n        case \"updatedAt\":\n          obj.headerName = \"Дата редактирования\";\n          obj.field = item;\n          obj.flex = 0.2;\n          break;\n\n        case \"note\":\n          obj.headerName = \"Примечание\";\n          obj.field = item;\n          obj.flex = 0.4;\n\n          obj.renderCell = params => /*#__PURE__*/_jsxDEV(Tooltip, {\n            title: params.row.note || \"\",\n            placement: \"bottom\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              style: {\n                textTransform: \"lowercase\",\n                overflow: \"hidden\"\n              },\n              children: params.row.note\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 64,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 63,\n            columnNumber: 13\n          }, this);\n\n          break;\n\n        default:\n          break;\n      }\n\n      if (data.locations.count > 0 && item !== \"deletedAt\") {\n        columns.push(obj);\n      }\n    });\n    let locations = {};\n    locations.rows = rows.map(row => {\n      row.createdAt = moment(row.createdAt).format(\"YYYY.MM.DD HH:mm\");\n      row.updatedAt = moment(row.updatedAt).format(\"YYYY.MM.DD HH:mm\");\n      return row;\n    });\n    locations.columns = columns;\n    return locations;\n  }; // Add Location\n\n\n  const addLocation = async location => {\n    try {\n      const res = await fetch(\"http://localhost:3001/api/v1/locations/\", {\n        method: \"POST\",\n        headers: {\n          \"Content-type\": \"application/json\"\n        },\n        body: JSON.stringify(location)\n      });\n      const data = await res.json();\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      let newRows = [];\n\n      if (locations.columns.length > 0) {\n        data.location[0].createdAt = moment(data.location.createdAt).format(\"YYYY.MM.DD HH:mm\");\n        data.location[0].updatedAt = moment(data.location.updatedAt).format(\"YYYY.MM.DD HH:mm\");\n        newRows = [...locations.rows, data.location[0]];\n        let newLocations = Object.assign({}, {\n          columns: locations.columns,\n          rows: newRows\n        });\n        setLocations(newLocations);\n      } else {\n        const locationsFromServer = await fetchLocations();\n        setLocations(locationsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  }; // Add Location\n\n\n  const updateLocation = async location => {\n    try {\n      console.log(JSON.stringify(location));\n      const res = await fetch(`http://localhost:3001/api/v1/locations/${location.id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-type\": \"application/json\"\n        },\n        body: JSON.stringify(location)\n      });\n      const data = await res.json();\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      data.location.createdAt = moment(data.location.createdAt).format(\"YYYY.MM.DD HH:mm\");\n      data.location.updatedAt = moment(data.location.updatedAt).format(\"YYYY.MM.DD HH:mm\");\n      let newRows = [];\n\n      if (locations.columns.length > 0) {\n        newRows = locations.rows.map(loc => loc.id === location.id ? data.location : loc);\n        let newLocations = Object.assign({}, {\n          columns: locations.columns,\n          rows: newRows\n        });\n        setLocations(newLocations);\n      } else {\n        const locationsFromServer = await fetchLocations();\n        setLocations(locationsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  }; // Delete Location\n\n\n  const deleteLocation = async parameters => {\n    try {\n      await fetch(`http://localhost:3001/api/v1/locations/${parameters.id}`, {\n        method: \"DELETE\"\n      });\n      let newRows = locations.rows.filter(row => row.id !== parameters.id);\n      let newLocations = Object.assign({}, {\n        columns: locations.columns,\n        rows: newRows\n      });\n      setLocations(newLocations);\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  }; // // Toggle Reminder\n  // const toggleReminder = async id => {\n  //   const locationToToggle = await fetchLocation(id);\n  //   const updLocation = {\n  //     ...locationToToggle,\n  //     reminder: !locationToToggle.reminder\n  //   };\n  //\n  //   const res = await fetch(`http://localhost:3001/api/v1/locations/${id}`, {\n  //     method: \"PUT\",\n  //     headers: {\n  //       \"Content-type\": \"application/json\"\n  //     },\n  //     body: JSON.stringify(updLocation)\n  //   });\n  //\n  //   const data = await res.json();\n  //\n  //   setLocations(\n  //     locations.map(location =>\n  //       location.id === id ? { ...location, reminder: data.reminder } : location\n  //     )\n  //   );\n  // };\n\n\n  return /*#__PURE__*/_jsxDEV(LocationTable, {\n    locations: locations,\n    deleteLocation: deleteLocation,\n    addLocation: addLocation,\n    updateLocation: updateLocation\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 234,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Location, \"dmcVB789TI/a5W5YpwfYeTSO0d8=\", false, function () {\n  return [useSnackbar];\n});\n\n_c = Location;\nexport default Location;\n\nvar _c;\n\n$RefreshReg$(_c, \"Location\");","map":{"version":3,"sources":["/home/lilit/workspace/vtk/from_scratch_frontend_vtk/src/containers/Locations.js"],"names":["useState","useEffect","useSnackbar","Tooltip","Button","LocationTable","moment","require","Location","locations","setLocations","enqueueSnackbar","getLocations","locationsFromServer","fetchLocations","res","fetch","data","json","columns","rows","locColumns","count","Object","keys","forEach","item","obj","headerName","field","hide","flex","renderCell","params","row","note","textTransform","overflow","push","map","createdAt","format","updatedAt","addLocation","location","method","headers","body","JSON","stringify","Error","newRows","length","newLocations","assign","err","console","log","message","variant","anchorOrigin","vertical","horizontal","updateLocation","id","loc","deleteLocation","parameters","filter"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useSnackbar } from \"notistack\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport Button from \"@material-ui/core/Button\";\nimport LocationTable from \"../components/Location/LocationTable\";\nvar moment = require(\"moment\");\n\nconst Location = () => {\n  const [locations, setLocations] = useState({});\n  const { enqueueSnackbar } = useSnackbar();\n\n  useEffect(() => {\n    const getLocations = async () => {\n      const locationsFromServer = await fetchLocations();\n      setLocations(locationsFromServer);\n    };\n    getLocations();\n  }, []);\n\n  // Fetch Locations\n  const fetchLocations = async () => {\n    const res = await fetch(\"http://localhost:3001/api/v1/locations\");\n    const data = await res.json();\n    let columns = [];\n    let rows = data.locations.rows;\n    let locColumns = [];\n    if (data.locations.count > 0)\n      locColumns = Object.keys(data.locations.rows[0]);\n\n    locColumns.forEach(item => {\n      let obj = {};\n      switch (item) {\n        case \"id\":\n          obj.headerName = \"ID\";\n          obj.field = item;\n          obj.hide = true;\n          break;\n        case \"number\":\n          obj.headerName = \"Номер\";\n          obj.field = item;\n          obj.flex = 0.1;\n          break;\n        case \"name\":\n          obj.headerName = \"Название\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n        case \"createdAt\":\n          obj.headerName = \"Дата создания\";\n          obj.field = item;\n          obj.flex = 0.2;\n          break;\n        case \"updatedAt\":\n          obj.headerName = \"Дата редактирования\";\n          obj.field = item;\n          obj.flex = 0.2;\n          break;\n        case \"note\":\n          obj.headerName = \"Примечание\";\n          obj.field = item;\n          obj.flex = 0.4;\n          obj.renderCell = (params: CellParams) => (\n            <Tooltip title={params.row.note || \"\"} placement=\"bottom\">\n              <Button\n                style={{ textTransform: \"lowercase\", overflow: \"hidden\" }}\n              >\n                {params.row.note}\n              </Button>\n            </Tooltip>\n          );\n          break;\n        default:\n          break;\n      }\n      if (data.locations.count > 0 && item !== \"deletedAt\") {\n        columns.push(obj);\n      }\n    });\n\n    let locations = {};\n    locations.rows = rows.map(row => {\n      row.createdAt = moment(row.createdAt).format(\"YYYY.MM.DD HH:mm\");\n      row.updatedAt = moment(row.updatedAt).format(\"YYYY.MM.DD HH:mm\");\n      return row;\n    });\n    locations.columns = columns;\n    return locations;\n  };\n\n  // Add Location\n  const addLocation = async location => {\n    try {\n      const res = await fetch(\"http://localhost:3001/api/v1/locations/\", {\n        method: \"POST\",\n        headers: {\n          \"Content-type\": \"application/json\"\n        },\n        body: JSON.stringify(location)\n      });\n\n      const data = await res.json();\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      let newRows = [];\n      if (locations.columns.length > 0) {\n        data.location[0].createdAt = moment(data.location.createdAt).format(\n          \"YYYY.MM.DD HH:mm\"\n        );\n        data.location[0].updatedAt = moment(data.location.updatedAt).format(\n          \"YYYY.MM.DD HH:mm\"\n        );\n        newRows = [...locations.rows, data.location[0]];\n        let newLocations = Object.assign(\n          {},\n          { columns: locations.columns, rows: newRows }\n        );\n        setLocations(newLocations);\n      } else {\n        const locationsFromServer = await fetchLocations();\n        setLocations(locationsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  // Add Location\n  const updateLocation = async location => {\n    try {\n      console.log(JSON.stringify(location));\n      const res = await fetch(\n        `http://localhost:3001/api/v1/locations/${location.id}`,\n        {\n          method: \"PUT\",\n          headers: {\n            \"Content-type\": \"application/json\"\n          },\n          body: JSON.stringify(location)\n        }\n      );\n\n      const data = await res.json();\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      data.location.createdAt = moment(data.location.createdAt).format(\n        \"YYYY.MM.DD HH:mm\"\n      );\n      data.location.updatedAt = moment(data.location.updatedAt).format(\n        \"YYYY.MM.DD HH:mm\"\n      );\n      let newRows = [];\n      if (locations.columns.length > 0) {\n        newRows = locations.rows.map(loc =>\n          loc.id === location.id ? data.location : loc\n        );\n        let newLocations = Object.assign(\n          {},\n          { columns: locations.columns, rows: newRows }\n        );\n        setLocations(newLocations);\n      } else {\n        const locationsFromServer = await fetchLocations();\n        setLocations(locationsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  // Delete Location\n  const deleteLocation = async parameters => {\n    try {\n      await fetch(`http://localhost:3001/api/v1/locations/${parameters.id}`, {\n        method: \"DELETE\"\n      });\n\n      let newRows = locations.rows.filter(row => row.id !== parameters.id);\n      let newLocations = Object.assign(\n        {},\n        { columns: locations.columns, rows: newRows }\n      );\n      setLocations(newLocations);\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  // // Toggle Reminder\n  // const toggleReminder = async id => {\n  //   const locationToToggle = await fetchLocation(id);\n  //   const updLocation = {\n  //     ...locationToToggle,\n  //     reminder: !locationToToggle.reminder\n  //   };\n  //\n  //   const res = await fetch(`http://localhost:3001/api/v1/locations/${id}`, {\n  //     method: \"PUT\",\n  //     headers: {\n  //       \"Content-type\": \"application/json\"\n  //     },\n  //     body: JSON.stringify(updLocation)\n  //   });\n  //\n  //   const data = await res.json();\n  //\n  //   setLocations(\n  //     locations.map(location =>\n  //       location.id === id ? { ...location, reminder: data.reminder } : location\n  //     )\n  //   );\n  // };\n  return (\n    <LocationTable\n      locations={locations}\n      deleteLocation={deleteLocation}\n      addLocation={addLocation}\n      updateLocation={updateLocation}\n    ></LocationTable>\n  );\n};\n\nexport default Location;\n"]},"metadata":{},"sourceType":"module"}