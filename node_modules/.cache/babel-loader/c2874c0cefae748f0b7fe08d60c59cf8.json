{"ast":null,"code":"var _jsxFileName = \"/home/lilit/workspace/vtk/from_scratch_frontend_vtk/src/containers/Products.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport { useSnackbar } from \"notistack\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport ProductTable from \"../components/Product/ProductTable\";\nimport Button from \"@material-ui/core/Button\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar moment = require(\"moment\");\n\nconst Product = () => {\n  _s();\n\n  const [products, setProducts] = useState({});\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  useEffect(() => {\n    const getProducts = async () => {\n      const productsFromServer = await fetchProducts();\n      setProducts(productsFromServer);\n    };\n\n    getProducts();\n  }, []); // Fetch Products\n\n  const fetchProducts = async () => {\n    const res = await fetch(\"http://localhost:3001/api/v1/products\");\n    const data = await res.json();\n\n    let _data = Object.assign({}, data);\n\n    console.log({\n      _data\n    });\n    let columns = [];\n    let rows = [...data.products.rows];\n    console.log({\n      rows\n    });\n    let products = {};\n    products.rows = rows.map(row => {\n      console.log({\n        row\n      });\n      row.createdAt = moment(row.createdAt).format(\"YYYY.MM.DD HH:mm\");\n      row.updatedAt = moment(row.updatedAt).format(\"YYYY.MM.DD HH:mm\"); // if (row.type) {\n      //   row.typeNumber = row.type.number;\n      //   row.type = row.type.name;\n      // } else {\n      //   row.typeNumber = \"\";\n      // }\n      // if (row.naming) row.naming = row.naming.name;\n      // if (row.decimalNumber) row.decimalNumber = row.decimalNumber.name;\n      // if (row.location) {\n      //   row.location = row.location.name;\n      //   row.locationNumber = row.location.number;\n      // } else {\n      //   row.locationNumber = \"\";\n      // }\n      // if (row.note) row.note = row.note.name;\n      // if (row.employee) row.employee = row.employee.name;\n\n      console.log(\"after change \", {\n        row\n      });\n      return row;\n    });\n    let locColumns = [];\n    if (data.products.count > 0) locColumns = Object.keys(data.products.rows[0]);\n    locColumns.forEach(item => {\n      let obj = {};\n\n      switch (item) {\n        case \"id\":\n          obj.hide = true;\n          obj.headerName = \"ID\";\n          obj.field = item;\n          obj.flex = 0.2;\n          break;\n\n        case \"naming\":\n          obj.headerName = \"Наименование\";\n          obj.field = item;\n          obj.flex = 0.6;\n          break;\n\n        case \"number\":\n          obj.headerName = \"Номер\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n\n        case \"decimalNumber\":\n          obj.headerName = \"Децимальный номер\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n\n        case \"bookingDate\":\n          obj.headerName = \"Дата бронирования\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n\n        case \"year\":\n          obj.headerName = \"Год\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n\n        case \"location\":\n          obj.headerName = \"Место производства\";\n          obj.field = item;\n          obj.flex = 0.3;\n\n          obj.renderCell = params => /*#__PURE__*/_jsxDEV(Tooltip, {\n            title: params.row.location || \"\",\n            placement: \"bottom\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              style: {\n                textTransform: \"lowercase\"\n              },\n              children: params.row.locationNumber\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 99,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 13\n          }, this);\n\n          break;\n\n        case \"type\":\n          obj.headerName = \"Тип изделия \";\n          obj.field = item;\n          obj.flex = 0.3;\n\n          obj.renderCell = params => /*#__PURE__*/_jsxDEV(Tooltip, {\n            title: params.row.type || \"\",\n            placement: \"bottom\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              style: {\n                textTransform: \"lowercase\"\n              },\n              children: params.row.typeNumber\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 13\n          }, this);\n\n          break;\n\n        case \"serialNumber\":\n          obj.headerName = \"Порядковый номер\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n\n        case \"employee\":\n          obj.headerName = \"Сотрудник\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n\n        case \"description\":\n          obj.headerName = \"Описание\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n\n        case \"createdAt\":\n          obj.hide = true;\n          obj.headerName = \"Дата создания\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n\n        case \"updatedAt\":\n          obj.hide = true;\n          obj.headerName = \"Дата редактирования\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n\n        case \"note\":\n          obj.headerName = \"Примечание\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n\n        default:\n          break;\n      }\n\n      if (data.products.count > 0 && item !== \"deletedAt\" && item !== \"typeId\" && item !== \"namingId\" && item !== \"locationId\" && item !== \"noteId\" && item !== \"typeNumber\" && item !== \"locationNumber\" && item !== \"decimalNumberId\" && item !== \"employeeId\") {\n        columns.push(obj);\n      }\n    });\n    let _columns = [];\n    columns.forEach((col, index) => {\n      if (col.field === \"id\") _columns[0] = col;\n      if (col.field === \"number\") _columns[1] = col;\n      if (col.field === \"naming\") _columns[2] = col;\n      if (col.field === \"decimalNumber\") _columns[3] = col;\n      if (col.field === \"bookingDate\") _columns[4] = col;\n      if (col.field === \"year\") _columns[5] = col;\n      if (col.field === \"location\") _columns[6] = col;\n      if (col.field === \"type\") _columns[7] = col;\n      if (col.field === \"serialNumber\") _columns[8] = col;\n      if (col.field === \"note\") _columns[9] = col;\n      if (col.field === \"employee\") _columns[10] = col;\n      if (col.field === \"description\") _columns[11] = col;\n      if (col.field === \"createdAt\") _columns[12] = col;\n      if (col.field === \"updatedAt\") _columns[13] = col;\n    });\n    products.columns = _columns;\n    return products;\n  };\n\n  const addProduct = async product => {\n    try {\n      const res = await fetch(\"http://localhost:3001/api/v1/products/\", {\n        method: \"POST\",\n        body: JSON.stringify(product),\n        headers: {\n          \"Content-type\": \"application/json\"\n        }\n      });\n      const data = await res.json();\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      let newRows = [];\n      console.log({\n        data\n      });\n\n      if (products.columns.length > 0) {\n        data.product.createdAt = moment(data.product.createdAt).format(\"YYYY.MM.DD HH:mm\");\n        data.product.updatedAt = moment(data.product.updatedAt).format(\"YYYY.MM.DD HH:mm\");\n        newRows = [...products.rows, data.product];\n        let newProducts = Object.assign({}, {\n          columns: products.columns,\n          rows: newRows\n        });\n        setProducts(newProducts);\n      } else {\n        const productsFromServer = await fetchProducts();\n        setProducts(productsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  const updateProduct = async product => {\n    try {\n      const res = await fetch(`http://localhost:3001/api/v1/products/${product.id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-type\": \"application/json\"\n        },\n        body: JSON.stringify(product)\n      });\n      const data = await res.json();\n      console.log({\n        data\n      });\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      data.product.createdAt = moment(data.product.createdAt).format(\"YYYY.MM.DD HH:mm\");\n      data.product.updatedAt = moment(data.product.updatedAt).format(\"YYYY.MM.DD HH:mm\");\n      let newRows = [];\n\n      if (products.columns.length > 0) {\n        newRows = products.rows.map(prod => prod.id === product.id ? data.product : prod);\n        let newProducts = Object.assign({}, {\n          columns: products.columns,\n          rows: newRows\n        });\n        setProducts(newProducts);\n      } else {\n        const productsFromServer = await fetchProducts();\n        setProducts(productsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  }; // Delete Product\n\n\n  const deleteProduct = async parameters => {\n    try {\n      await fetch(`http://localhost:3001/api/v1/products/${parameters.id}`, {\n        method: \"DELETE\"\n      });\n      let newRows = products.rows.filter(row => row.id !== parameters.id);\n      let newProducts = Object.assign({}, {\n        columns: products.columns,\n        rows: newRows\n      });\n      setProducts(newProducts);\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(ProductTable, {\n    products: products,\n    deleteProduct: deleteProduct,\n    addProduct: addProduct,\n    updateProduct: updateProduct\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 312,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Product, \"yOAbBplHxjJC3bxUwMqAivicWvs=\", false, function () {\n  return [useSnackbar];\n});\n\n_c = Product;\nexport default Product;\n\nvar _c;\n\n$RefreshReg$(_c, \"Product\");","map":{"version":3,"sources":["/home/lilit/workspace/vtk/from_scratch_frontend_vtk/src/containers/Products.js"],"names":["useState","useEffect","useSnackbar","Tooltip","ProductTable","Button","moment","require","Product","products","setProducts","enqueueSnackbar","getProducts","productsFromServer","fetchProducts","res","fetch","data","json","_data","Object","assign","console","log","columns","rows","map","row","createdAt","format","updatedAt","locColumns","count","keys","forEach","item","obj","hide","headerName","field","flex","renderCell","params","location","textTransform","locationNumber","type","typeNumber","push","_columns","col","index","addProduct","product","method","body","JSON","stringify","headers","Error","newRows","length","newProducts","err","message","variant","anchorOrigin","vertical","horizontal","updateProduct","id","prod","deleteProduct","parameters","filter"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useSnackbar } from \"notistack\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\nimport ProductTable from \"../components/Product/ProductTable\";\nimport Button from \"@material-ui/core/Button\";\nvar moment = require(\"moment\");\n\nconst Product = () => {\n  const [products, setProducts] = useState({});\n  const { enqueueSnackbar } = useSnackbar();\n\n  useEffect(() => {\n    const getProducts = async () => {\n      const productsFromServer = await fetchProducts();\n      setProducts(productsFromServer);\n    };\n    getProducts();\n  }, []);\n\n  // Fetch Products\n  const fetchProducts = async () => {\n    const res = await fetch(\"http://localhost:3001/api/v1/products\");\n    const data = await res.json();\n    let _data = Object.assign({}, data);\n    console.log({ _data });\n    let columns = [];\n    let rows = [...data.products.rows];\n    console.log({ rows });\n    let products = {};\n\n    products.rows = rows.map(row => {\n      console.log({ row });\n      row.createdAt = moment(row.createdAt).format(\"YYYY.MM.DD HH:mm\");\n      row.updatedAt = moment(row.updatedAt).format(\"YYYY.MM.DD HH:mm\");\n      // if (row.type) {\n      //   row.typeNumber = row.type.number;\n      //   row.type = row.type.name;\n      // } else {\n      //   row.typeNumber = \"\";\n      // }\n      // if (row.naming) row.naming = row.naming.name;\n      // if (row.decimalNumber) row.decimalNumber = row.decimalNumber.name;\n      // if (row.location) {\n      //   row.location = row.location.name;\n      //   row.locationNumber = row.location.number;\n      // } else {\n      //   row.locationNumber = \"\";\n      // }\n      // if (row.note) row.note = row.note.name;\n      // if (row.employee) row.employee = row.employee.name;\n      console.log(\"after change \", { row });\n\n      return row;\n    });\n    let locColumns = [];\n    if (data.products.count > 0)\n      locColumns = Object.keys(data.products.rows[0]);\n\n    locColumns.forEach(item => {\n      let obj = {};\n      switch (item) {\n        case \"id\":\n          obj.hide = true;\n          obj.headerName = \"ID\";\n          obj.field = item;\n          obj.flex = 0.2;\n          break;\n        case \"naming\":\n          obj.headerName = \"Наименование\";\n          obj.field = item;\n          obj.flex = 0.6;\n          break;\n        case \"number\":\n          obj.headerName = \"Номер\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n        case \"decimalNumber\":\n          obj.headerName = \"Децимальный номер\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n        case \"bookingDate\":\n          obj.headerName = \"Дата бронирования\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n        case \"year\":\n          obj.headerName = \"Год\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n        case \"location\":\n          obj.headerName = \"Место производства\";\n          obj.field = item;\n          obj.flex = 0.3;\n          obj.renderCell = (params: CellParams) => (\n            <Tooltip title={params.row.location || \"\"} placement=\"bottom\">\n              <Button style={{ textTransform: \"lowercase\" }}>\n                {params.row.locationNumber}\n              </Button>\n            </Tooltip>\n          );\n          break;\n        case \"type\":\n          obj.headerName = \"Тип изделия \";\n          obj.field = item;\n          obj.flex = 0.3;\n          obj.renderCell = (params: CellParams) => (\n            <Tooltip title={params.row.type || \"\"} placement=\"bottom\">\n              <Button style={{ textTransform: \"lowercase\" }}>\n                {params.row.typeNumber}\n              </Button>\n            </Tooltip>\n          );\n          break;\n        case \"serialNumber\":\n          obj.headerName = \"Порядковый номер\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n        case \"employee\":\n          obj.headerName = \"Сотрудник\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n        case \"description\":\n          obj.headerName = \"Описание\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n        case \"createdAt\":\n          obj.hide = true;\n          obj.headerName = \"Дата создания\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n        case \"updatedAt\":\n          obj.hide = true;\n          obj.headerName = \"Дата редактирования\";\n          obj.field = item;\n          obj.flex = 0.3;\n          break;\n        case \"note\":\n          obj.headerName = \"Примечание\";\n          obj.field = item;\n          obj.flex = 0.4;\n          break;\n        default:\n          break;\n      }\n      if (\n        data.products.count > 0 &&\n        item !== \"deletedAt\" &&\n        item !== \"typeId\" &&\n        item !== \"namingId\" &&\n        item !== \"locationId\" &&\n        item !== \"noteId\" &&\n        item !== \"typeNumber\" &&\n        item !== \"locationNumber\" &&\n        item !== \"decimalNumberId\" &&\n        item !== \"employeeId\"\n      ) {\n        columns.push(obj);\n      }\n    });\n\n    let _columns = [];\n\n    columns.forEach((col, index) => {\n      if (col.field === \"id\") _columns[0] = col;\n      if (col.field === \"number\") _columns[1] = col;\n      if (col.field === \"naming\") _columns[2] = col;\n      if (col.field === \"decimalNumber\") _columns[3] = col;\n      if (col.field === \"bookingDate\") _columns[4] = col;\n      if (col.field === \"year\") _columns[5] = col;\n      if (col.field === \"location\") _columns[6] = col;\n      if (col.field === \"type\") _columns[7] = col;\n      if (col.field === \"serialNumber\") _columns[8] = col;\n      if (col.field === \"note\") _columns[9] = col;\n      if (col.field === \"employee\") _columns[10] = col;\n      if (col.field === \"description\") _columns[11] = col;\n      if (col.field === \"createdAt\") _columns[12] = col;\n      if (col.field === \"updatedAt\") _columns[13] = col;\n    });\n\n    products.columns = _columns;\n    return products;\n  };\n\n  const addProduct = async product => {\n    try {\n      const res = await fetch(\"http://localhost:3001/api/v1/products/\", {\n        method: \"POST\",\n        body: JSON.stringify(product),\n        headers: {\n          \"Content-type\": \"application/json\"\n        }\n      });\n\n      const data = await res.json();\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      let newRows = [];\n      console.log({ data });\n      if (products.columns.length > 0) {\n        data.product.createdAt = moment(data.product.createdAt).format(\n          \"YYYY.MM.DD HH:mm\"\n        );\n        data.product.updatedAt = moment(data.product.updatedAt).format(\n          \"YYYY.MM.DD HH:mm\"\n        );\n\n        newRows = [...products.rows, data.product];\n        let newProducts = Object.assign(\n          {},\n          { columns: products.columns, rows: newRows }\n        );\n        setProducts(newProducts);\n      } else {\n        const productsFromServer = await fetchProducts();\n        setProducts(productsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  const updateProduct = async product => {\n    try {\n      const res = await fetch(\n        `http://localhost:3001/api/v1/products/${product.id}`,\n        {\n          method: \"PUT\",\n          headers: {\n            \"Content-type\": \"application/json\"\n          },\n          body: JSON.stringify(product)\n        }\n      );\n\n      const data = await res.json();\n      console.log({ data });\n      if (data[\"Bad Request\"]) throw new Error(data[\"Bad Request\"]);\n      if (data[\"errorMessage\"]) throw new Error(data[\"errorMessage\"]);\n      data.product.createdAt = moment(data.product.createdAt).format(\n        \"YYYY.MM.DD HH:mm\"\n      );\n      data.product.updatedAt = moment(data.product.updatedAt).format(\n        \"YYYY.MM.DD HH:mm\"\n      );\n      let newRows = [];\n\n      if (products.columns.length > 0) {\n        newRows = products.rows.map(prod =>\n          prod.id === product.id ? data.product : prod\n        );\n        let newProducts = Object.assign(\n          {},\n          { columns: products.columns, rows: newRows }\n        );\n        setProducts(newProducts);\n      } else {\n        const productsFromServer = await fetchProducts();\n        setProducts(productsFromServer);\n      }\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  // Delete Product\n  const deleteProduct = async parameters => {\n    try {\n      await fetch(`http://localhost:3001/api/v1/products/${parameters.id}`, {\n        method: \"DELETE\"\n      });\n\n      let newRows = products.rows.filter(row => row.id !== parameters.id);\n      let newProducts = Object.assign(\n        {},\n        { columns: products.columns, rows: newRows }\n      );\n      setProducts(newProducts);\n    } catch (err) {\n      console.log(err);\n      enqueueSnackbar(`${err.message}`, {\n        variant: \"error\",\n        anchorOrigin: {\n          vertical: \"top\",\n          horizontal: \"center\"\n        }\n      });\n    }\n  };\n\n  return (\n    <ProductTable\n      products={products}\n      deleteProduct={deleteProduct}\n      addProduct={addProduct}\n      updateProduct={updateProduct}\n    ></ProductTable>\n  );\n};\n\nexport default Product;\n"]},"metadata":{},"sourceType":"module"}